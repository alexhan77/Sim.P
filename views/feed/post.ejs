<h1>POST HERE</h1>
<div class="container">
    
  <button id="upload_widget" class="cloudinary-button">Upload files</button>
    <form method="POST" action="/feed/post">
        <input type="text" name="userId" value="<%=user.id%>" hidden>
        <!-- TODO: figure out to get the cloudinary link into my database -->
        <input type="text" name="url" value="hidden>
        <input type="text" name="content" placeholder="bio">
        <button class="btn waves-effect waves-light" type="submit" name="action">Submit
            <i class="material-icons right">send</i>
        </button>

</form>
<br>
<a href="/profile/user" class="btn waves-light">Back to Profile</a>
</div>


<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>  

<script type="text/javascript">  

var myWidget = cloudinary.createUploadWidget({
  cloudName: 'jummay', 
  uploadPreset: 'dpcl6mvq'}, (error, result) => { 
    if (!error && result && result.event === "success") { 
      console.log('Done! Here is the image info: ', result.info); 
      console.log(result.info.secure_url)
      fetch("/feed/post", {
        method: "POST",
        body: JSON.stringify({ url: result.info.secure_url }),
        headers: { "Content-Type": "application/json; charset=utf-8"}
      })
      .then((response) => {
        picBox.textContent = result.info.secure_url
      })
      .catch(err => {
        console.log(err)
      })
    }
    else {
      console.log(error)
    }
  }
)

document.getElementById("upload_widget").addEventListener("click", function(){
    myWidget.open();
  }, false);
</script>

